@* @using GoogleCaptcha.HtmlHelpers; *@

@{
    ViewBag.Title = "Trouvez un spécialiste du traitement par BOTOX®";
}

@section headings
{
    <h1>Trouvez un spécialiste du traitement par BOTOX<sup>&reg;</sup></h1>
    <h2 class="mt-5">À L’INTENTION DES PROFESSIONNELS DE LA SANTÉ</h2>
}

<form class="login-form" method="post" data-bind="submit: $root.submit" action="@Url.Action("LoginSubmit","Home")">
    @Html.AntiForgeryToken()
    <section id="main" class="login pt-3 pb-5">
        <div class="container-fluid">
            <div class="row mb-3">
                <div class="col-md-6 col-lg-8 offset-md-3 offset-lg-2 ps-4">
                    <h1 class="mt-5 mb-4">
                        Je suis un professionnel canadien (sélectionner une option)&nbsp;:
                    </h1>
                </div>
            </div>

            <div class="row mt-3 mb-3">
                <div class="col-md-6 col-lg-8 offset-md-3 offset-lg-2 ps-4">
                    <div class="row">
                        <div class="col-12 radio-options" data-bind="foreach: specialties">
                            <label class="p-2 ps-md-0 pe-5">
                                <span class="pe-2" data-bind="text: $data"></span>

                                <img src="/img/radio_selected.png" data-bind="visible: $root.specialty() === $data">
                                <img src="/img/radio_blank.png" data-bind="visible: $root.specialty() !== $data">

                                <input type="radio" name="specialty" class="input-hidden"
                                    data-bind="checked: $root.specialty, attr: { value: $data }">
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="login dark pt-3 pb-5">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-6 col-lg-8 offset-md-3 offset-lg-2 ps-4">
                    <hr class="mt-4 mb-5 dotted purple">
                </div>

                <div class="col-md-6 col-lg-8 offset-md-3 offset-lg-2 ps-4">
                    <div class="row">
                        <div class="col-12 d-flex flex-wrap align-items-center gap-3 my-3">
                            <select class="form-control" name="province" data-bind="value: province" required>
                                <option value="">Province/Territoire :</option>
                                <option value="alberta">Alberta</option>
                                <option value="british_columbia">Colombie-Britannique</option>
                                <option value="prince_edward_island">Île-du-Prince-Édouard</option>
                                <option value="manitoba">Manitoba</option>
                                <option value="new_brunswick">Nouveau-Brunswick</option>
                                <option value="nova_scotia">Nouvelle-Écosse</option>
                                <option value="nunavut">Nunavut</option>
                                <option value="ontario">Ontario</option>
                                <option value="quebec">Québec</option>
                                <option value="saskatchewan">Saskatchewan</option>
                                <option value="newfoundland">Terre-Neuve-et-Labrador</option>
                                <option value="northwest_territories">Territoires du Nord-Ouest</option>
                                <option value="yukon">Yukon</option>
                            </select>
                            <div class="text-center arrow">
                                &rarr;
                            </div>
                            <input class="form-control" type="text" name="license_number"
                                data-bind="textInput: licenseNumber" placeholder="Numéro de permis professionnel :">
                            <div class="error-message text-center p-1"
                                data-bind="visible: errorInput, html: errorInput"></div>
                        </div>

                        <div class="col-12">
                            <input class="btn btn-purple-arrow mt-3 mb-5" type="submit" value="Entrée">
                        </div>
                    </div>

                    @* <div class="rowform-group">
                        <div class="col-12 col-md-8">
                            @Html.GoogleCaptcha()
                            @Html.InvalidGoogleCaptchaLabel("Captcha is not valid !")
                        </div>
                    </div> *@
                </div>
            </div>
        </div>
    </section>
</form>

<div class="modal legal-modal show" tabindex="-1">
    <div class="modal-dialog" style="max-width: 90%;">
        <div class="modal-content" style="border-radius:2rem;">
            <div class="modal-header  border-0">
                <h5 class="modal-title"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="px-2 px-md-5">
                    <strong>En cochant la case « J’accepte », je confirme avoir demandé les coordonnées de médecins
                        exerçant dans ma région qui ont les qualifications et l’expérience adéquates dans le traitement
                        des céphalées et l’utilisation du matériel nécessaire pour administrer BOTOX dans le traitement
                        de la migraine chronique, aux fins de recommandations de patients; de plus, je comprends et
                        reconnais que :</strong>
                    <ul>
                        <li>
                            <span class="text-underline font-weight-bold">Autodéclaration des qualifications.</span>
                            L’outil TrouverUnSpecialisteBOTOX (« répertoire ») présente une liste de coordonnées de
                            médecins ayant eux-mêmes attesté avoir les qualifications et l’expérience adéquates dans le
                            traitement des céphalées et l’administration de BOTOX pour ce traitement. Je reconnais
                            devoir diriger mes patients vers un médecin que j’estime le plus compétent en la matière, en
                            usant de ma discrétion professionnelle. Si je décide de diriger un patient vers un médecin
                            dont le nom apparaît dans le répertoire, j’assume l’entière responsabilité de cet aiguillage
                            et des soins que recevra ce patient. AbbVie ne joue aucun rôle dans la prestation de soins
                            aux patients ni dans la facilitation de la communication entre moi et tout autre médecin.
                        </li>
                        <li>
                            <span class="text-underline font-weight-bold">Absence de recommandation.</span> Les
                            coordonnées de médecins sont fournies dans le répertoire pour des raisons pratiques, à titre
                            informatif seulement. L’inscription d’un médecin au répertoire ne doit pas être interprétée
                            comme une recommandation de ce médecin par AbbVie. AbbVie n’a procédé à aucune vérification
                            diligente des qualifications ou de l’expérience des médecins inscrits dans le répertoire.
                        </li>
                        <li>
                            <span class="text-underline font-weight-bold">Non exhaustivité du répertoire.</span> Le
                            répertoire n’est pas exhaustif. D’autres spécialistes de ma région géographique pourraient
                            avoir l’expérience dans le diagnostic et le traitement de la migraine chronique.
                        </li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer border-0 justify-content-start">
                <div class="flex flex-row px-2 px-md-5">
                    <button type="button" class="btn mb-5 mr-2 py-3 px-5"
                        style="color: white; background-color: #7d4199; border-color: #7d4199;"
                        data-bs-dismiss="modal">Gérer vos choix</button>
                    <button data-bind="disable: !viewModel.privacy()" type="button" class="btn btn-agree mb-5 py-3 px-5"
                        style="color: white; background-color: #7d4199; border-color: #7d4199;">Accepter et
                        continuer</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts
{
    <script>
        function LoginViewModel() {
            var self = this;
            this.specialty = ko.observable('');
            this.province = ko.observable('');
            this.licenseNumber = ko.observable('');
            this.legalAccept = ko.observable(false);
            this.privacy = ko.observable(true);

            this.specialties = ['Neurologue', 'INFIRMIER PRATICIEN/INFIRMIÈRE PRATICIENNE', 'Médecin en soins primaires', 'AUTRE PROFESSIONNEL DE LA SANTÉ'];
            this.errorInput = ko.observable(false);

            this.submit = function () {
                this.errorInput(false);

                if (!this.specialty()) {
                    this.errorInput('Veuillez sélectionner une profession.')
                    return false;
                }


                if (!this.province()) {
                    // using bootstrap error message here.
                    return false;
                }

                if (!this.licenseNumber()) {
                    this.errorInput('Désolé, mais le numéro que vous avez saisi n’est pas valide.');
                    return false;
                }

                url = '@Url.Action("ValidateId", "Gating")?id=' + self.licenseNumber() + '&province=' + self.province() + '&specialty=' + self.specialty();

                let result = false;

                if (url) {
                    $.ajax({
                        url: url,
                        type: 'get',
                        async: false,
                        success: function (response) {
                            result = response;
                        }
                    })
                }

                if (!result) {
                    self.errorInput('Désolé, mais le numéro que vous avez saisi n’est pas valide.');
                    return false;
                } else {
                    grecaptcha.execute();

                    if (!self.legalAccept()) {
                        $('.legal-modal').modal('show');
                        return false;
                    }
                }

                return true;
            }
        }

        var viewModel = null;
        $(function () {
            viewModel = new LoginViewModel();
            ko.applyBindings(viewModel);



            $('.btn-agree').click(function () {
                if (viewModel.privacy()) {
                    viewModel.legalAccept(true);
                } else {
                    viewModel.legalAccept(false);
                }
                $('.login-form').submit();
            });
        });
    </script>
}
